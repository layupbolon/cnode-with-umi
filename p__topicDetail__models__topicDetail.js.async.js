(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{C77o:function(e,t,a){"use strict";var n=a("284h"),r=a("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=r(a("o0o1")),c=r(a("LvDl")),p=n(a("3eXy")),l={namespace:"topicDetail",state:{dataSource:{},replyItems:[]},subscriptions:{setup:function(e){var t=e.dispatch,a=e.history;return a.listen(function(e){var a=e.pathname,n=c.default.split(c.default.trimStart(a,"/"),"/");if("topicDetail"===n[0]){var r=localStorage.getItem("User");if(r){var s=JSON.parse(r);t({type:"getTopicDetailData",payload:{id:n[1],accesstoken:s.accesstoken}})}else t({type:"getTopicDetailData",payload:{id:n[1]}})}})}},reducers:{changeState:function(e,t){var a=t.payload;e[a.key]=a.value},initState:function(e,t){t.payload;return{dataSource:{},replyItems:[]}}},effects:{getTopicDetailData:s.default.mark(function e(t,a){var n,r,c,l,i,u;return s.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=t.payload,r=a.call,c=a.put,e.next=4,c({type:"initState"});case 4:return l=n.id,i=n.accesstoken,e.next=7,r(p.GetTopicDetail,l,i);case 7:return u=e.sent,e.next=10,c({type:"changeState",payload:{key:"dataSource",value:u.data.data}});case 10:if(!(u.data.data.replies&&u.data.data.replies.length>0)){e.next=14;break}return u.data.data.replies.forEach(function(e){e.showReplyBox=!1}),e.next=14,c({type:"changeState",payload:{key:"replyItems",value:u.data.data.replies}});case 14:case"end":return e.stop()}},e,this)}),replyUp:s.default.mark(function e(t,a){var n,r,c,l,i,u,o,d,y;return s.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=t.payload,r=a.call,c=a.put,l=a.select,i=n.reply_id,u=n.accesstoken,e.next=5,r(p.replyUp,i,u);case 5:if(o=e.sent,!(o&&o.data&&o.data.success)){e.next=14;break}return e.next=9,l(function(e){return{replyItems:e.topicDetail.replyItems}});case 9:return d=e.sent,y=d.replyItems,y.forEach(function(e){e.id===i&&("up"===o.data.action&&(e.is_uped=!0,e.ups.push(i)),"down"===o.data.action&&(e.is_uped=!1,e.ups.length=e.ups.length-1))}),e.next=14,c({type:"changeState",payload:{key:"replyItems",value:y}});case 14:case"end":return e.stop()}},e,this)}),showReplyBox:s.default.mark(function e(t,a){var n,r,c,p,l,i;return s.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=t.payload,r=a.put,c=a.select,p=n.index,e.next=5,c(function(e){return{replyItems:e.topicDetail.replyItems}});case 5:return l=e.sent,i=l.replyItems,i&&i.length>0&&(i[p].showReplyBox=!i[p].showReplyBox),e.next=10,r({type:"changeState",payload:{key:"replyItems",value:i}});case 10:case"end":return e.stop()}},e,this)}),submitReply:s.default.mark(function e(t,a){var n,r,c,l,i;return s.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=t.payload,r=a.call,c=n.submitData,l=n.cb,e.next=5,r(p.PostReply,c);case 5:i=e.sent,i.data.success&&l&&l();case 7:case"end":return e.stop()}},e,this)})}};t.default=l}}]);